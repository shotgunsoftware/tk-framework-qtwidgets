



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>version_details.version_details &mdash; tk-framework-qtwidgets v2.5.15 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="tk-framework-qtwidgets v2.5.15 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    <a href='http://developer.shotgunsoftware.com'>
    
        <img style='width: 191px;
                height: 60px; 
                margin: 2px;
                border-radius: 0px; 
                padding: 0px;' 
            src='../../_static/logo@2x.png'/>
    
    </a>
    

          
            <a href="../../index.html" class="icon icon-home"> tk-framework-qtwidgets
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../activity_stream.html">Shotgun Activity Stream Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../elided_label.html">Auto-Elide label</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../global_search_completer.html">Shotgun Global Search Completer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../global_search_widget.html">Shotgun Global Search Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help_screen.html">Help Screen Popup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">Model Related Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../navigation.html">Navigation Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../note_input_widget.html">Shotgun Note Input Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overlay_widget.html">Text Overlay Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../playback_label.html">Shotgun Playback Label Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../screen_grab.html">Screen Capture Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shotgun_fields.html">Shotgun Field Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shotgun_menus.html">Shotgun Menus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spinner_widget.html">Spinner Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../views.html">View Related Classes</a></li>
</ul>

            
          
       
    <div style='margin-top: 50px;
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px; 
                color: #b3b3b3; 
                font-size: 70%;
                border-radius: 3px;
                background-color: #444;
                line-height: 18px;
                '>    
    <style>
        a.custom_post_menu { display: inline; 
                             padding: 0px; 
                             text-decoration: underline; }
    </style>

    <b>tk-framework-qtwidgets</b> v2.5.15.<br>
    
        This documentation is part of the Shotgun Pipeline Toolkit.
    
    For more information, please visit
    <a class=custom_post_menu href='https://support.shotgunsoftware.com/home'>Shotgun Support</a>.
    The code associated with this documentation can be found 
    <a class=custom_post_menu href='https://github.com/shotgunsoftware/tk-framework-qtwidgets'>here</a>.

    </div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">tk-framework-qtwidgets</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>version_details.version_details</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for version_details.version_details</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2016 Shotgun Software Inc.</span>
<span class="c1"># </span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1"># </span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit </span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your </span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights </span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sgtk</span>

<span class="kn">from</span> <span class="nn">sgtk.platform.qt</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>

<span class="kn">from</span> <span class="nn">.ui.version_details_widget</span> <span class="kn">import</span> <span class="n">Ui_VersionDetailsWidget</span>
<span class="kn">from</span> <span class="nn">.selection_context_menu</span> <span class="kn">import</span> <span class="n">SelectionContextMenu</span>

<span class="kn">from</span> <span class="nn">.qtwidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ShotgunEntityCardDelegate</span><span class="p">,</span>
    <span class="n">ShotgunFieldManager</span><span class="p">,</span>
    <span class="n">EntityFieldMenu</span><span class="p">,</span>
    <span class="n">ShotgunSortFilterProxyModel</span><span class="p">,</span>
    <span class="n">SimpleTooltipModel</span><span class="p">,</span>
    <span class="n">ShotgunMenu</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">shotgun_model</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">import_framework</span><span class="p">(</span>
    <span class="s2">&quot;tk-framework-shotgunutils&quot;</span><span class="p">,</span>
    <span class="s2">&quot;shotgun_model&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">shotgun_globals</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">import_framework</span><span class="p">(</span>
    <span class="s2">&quot;tk-framework-shotgunutils&quot;</span><span class="p">,</span>
    <span class="s2">&quot;shotgun_globals&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">task_manager</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">import_framework</span><span class="p">(</span>
    <span class="s2">&quot;tk-framework-shotgunutils&quot;</span><span class="p">,</span>
    <span class="s2">&quot;task_manager&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">shotgun_data</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">import_framework</span><span class="p">(</span>
    <span class="s2">&quot;tk-framework-shotgunutils&quot;</span><span class="p">,</span>
    <span class="s2">&quot;shotgun_data&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">settings</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">import_framework</span><span class="p">(</span>
    <span class="s2">&quot;tk-framework-shotgunutils&quot;</span><span class="p">,</span>
    <span class="s2">&quot;settings&quot;</span><span class="p">,</span>
<span class="p">)</span>

<div class="viewcode-block" id="VersionDetailsWidget"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget">[docs]</a><span class="k">class</span> <span class="nc">VersionDetailsWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QT Widget that displays details and Note thread data for a given Version</span>
<span class="sd">    entity.</span>

<span class="sd">    :signal entity_created(object): Fires when a Note or Reply entity is created by</span>
<span class="sd">            an underlying widget within the activity stream. Passes on a Shotgun</span>
<span class="sd">            entity definition in the form of a dict.</span>
<span class="sd">    :signal entity_loaded(object): Fires when a Version entity has been loaded by</span>
<span class="sd">            the widget. Passes on a Shotgun entity definition in the form of a dict.</span>
<span class="sd">    :signal note_selected(int): Fires when a Note entity is selected in the widget&#39;s</span>
<span class="sd">            note thread stream. Passes on the entity id of the selected note.</span>
<span class="sd">    :signal note_deselected(int): Fires when a Note entity is deselected. Passes on</span>
<span class="sd">            the entity id of the selected note.</span>
<span class="sd">    :signal note_arrived(int, object): Fires when a new Note entity arrives and is</span>
<span class="sd">            displayed in the widget&#39;s note thread stream. Passes on the entity id</span>
<span class="sd">            and Shotgun entity definition as an int and dict, respectively.</span>
<span class="sd">    :signal note_metadata_changed(int, str): Fires when the widget successfully</span>
<span class="sd">            updates a Note entity&#39;s metadata field. The Note entity&#39;s id and the</span>
<span class="sd">            new metadata are passed on.</span>
<span class="sd">    :signal note_attachment_arrived(int, str): Fires when an attachment file</span>
<span class="sd">            associated with a Note entity is successfully downloaded. The Note</span>
<span class="sd">            entity id and the path to the file on disk are passed on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">FIELDS_PREFS_KEY</span> <span class="o">=</span> <span class="s2">&quot;version_details_fields&quot;</span>
    <span class="n">ACTIVE_FIELDS_PREFS_KEY</span> <span class="o">=</span> <span class="s2">&quot;version_details_active_fields&quot;</span>
    <span class="n">VERSION_LIST_FIELDS_PREFS_KEY</span> <span class="o">=</span> <span class="s2">&quot;version_details_version_list_fields&quot;</span>
    <span class="n">NOTE_METADATA_FIELD</span> <span class="o">=</span> <span class="s2">&quot;sg_metadata&quot;</span>
    <span class="n">NOTE_MARKUP_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;__note_markup__&quot;</span>

    <span class="c1"># Emitted when an entity is created by the panel. The</span>
    <span class="c1"># entity type as a string and id as an int are passed</span>
    <span class="c1"># along.</span>
    <span class="n">entity_created</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="c1"># Emitted when an entity is loaded in the panel.</span>
    <span class="n">entity_loaded</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="c1"># The int is the id of the Note entity that was selected or deselected.</span>
    <span class="n">note_selected</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">note_deselected</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">note_arrived</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
    <span class="n">note_metadata_changed</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="n">note_attachment_arrived</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bg_task_manager</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a new :class:`~VersionDetailsWidget` object.</span>

<span class="sd">        :param parent:          The widget&#39;s parent.</span>
<span class="sd">        :param bg_task_manager: A :class:`~BackgroundTaskManager` object.</span>
<span class="sd">        :param entity:          A Shotgun Version entity dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VersionDetailsWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_entity</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pinned</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_versions_ascending</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_task_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span> <span class="o">=</span> <span class="n">bg_task_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_context_menu_actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_note_metadata_uids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_note_set_metadata_uids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uploads_uids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attachment_uids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_note_fields</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NOTE_METADATA_FIELD</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments_filter</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_submit_callback</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_VersionDetailsWidget</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Show the &quot;empty&quot; image that tells the user that no Version</span>
        <span class="c1"># is active.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pages</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">empty_page</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span> <span class="o">=</span> <span class="n">shotgun_data</span><span class="o">.</span><span class="n">ShotgunDataRetriever</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">bg_task_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_field_manager</span> <span class="o">=</span> <span class="n">ShotgunFieldManager</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">bg_task_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">UserSettings</span><span class="p">(</span>
            <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_bundle</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="n">shotgun_globals</span><span class="o">.</span><span class="n">register_bg_task_manager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_field_manager</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="c1"># These are the minimum required fields that we need</span>
        <span class="c1"># in order to draw all of our widgets with default settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;image&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project&quot;</span><span class="p">,</span>
            <span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sg_status_list&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">prefs_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">FIELDS_PREFS_KEY</span><span class="p">,</span>
            <span class="p">[],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">prefs_fields</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">])</span>

        <span class="c1"># These are the fields that have been given to the info widget</span>
        <span class="c1"># at the top of the Notes tab. This represents all fields that</span>
        <span class="c1"># are displayed by default when the &quot;More info&quot; option is active.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">ACTIVE_FIELDS_PREFS_KEY</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="s2">&quot;code&quot;</span><span class="p">,</span>
                <span class="s2">&quot;entity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sg_status_list&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># This is the subset of self._active_fields that are always</span>
        <span class="c1"># visible, even when &quot;More info&quot; is not active.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_persistent_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entity&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># The fields list for the Version list view delegate operate</span>
        <span class="c1"># the same way as the above persistent list. We&#39;re simply</span>
        <span class="c1"># keeping track of what we don&#39;t allow to be turned off.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_persistent_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sg_status_list&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Our sort-by list will include &quot;id&quot; at the head.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_sort_by_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_persistent_fields</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version_model</span> <span class="o">=</span> <span class="n">SimpleTooltipModel</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_tab</span><span class="p">,</span>
            <span class="n">bg_task_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span> <span class="o">=</span> <span class="n">ShotgunSortFilterProxyModel</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">filter_by_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_persistent_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">sort_by_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_sort_by_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">setFilterWildcard</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">setSourceModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span> <span class="o">=</span> <span class="n">ShotgunEntityCardDelegate</span><span class="p">(</span>
            <span class="n">view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="p">,</span>
            <span class="n">shotgun_field_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_field_manager</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">VERSION_LIST_FIELDS_PREFS_KEY</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_persistent_fields</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">label_exempt_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">set_bg_task_manager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">show_sg_stream_button</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">version_items_playable</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">clickable_user_icons</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">show_note_links</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">highlight_new_arrivals</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">notes_are_selectable</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_info_model</span> <span class="o">=</span> <span class="n">shotgun_model</span><span class="o">.</span><span class="n">SimpleShotgunModel</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="p">,</span>
            <span class="n">bg_task_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># For the basic info widget in the Notes stream we won&#39;t show</span>
        <span class="c1"># labels for the fields that are persistent. The non-standard,</span>
        <span class="c1"># user-specified list of fields that are shown when &quot;more info&quot;</span>
        <span class="c1"># is active will be labeled.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">field_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shotgun_field_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">label_exempt_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_persistent_fields</span>

        <span class="c1"># Signal handling.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pin_button</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">set_pinned</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_info_button</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_more_info_toggled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">shotgun_nav_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">_load_shotgun_activity_stream</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_version_context_menu</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_search</span><span class="o">.</span><span class="n">search_edited</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_version_list_filter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_info_model</span><span class="o">.</span><span class="n">data_refreshed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version_entity_data_refreshed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task_manager</span><span class="o">.</span><span class="n">task_completed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_task_completed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">note_selected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">note_selected</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">note_deselected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">note_deselected</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">note_arrived</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_note_arrival</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span><span class="o">.</span><span class="n">work_completed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__on_worker_signal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span><span class="o">.</span><span class="n">work_failure</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__on_worker_failure</span><span class="p">)</span>

        <span class="c1"># We&#39;re taking over the responsibility of handling the title bar&#39;s</span>
        <span class="c1"># typical responsibilities of closing the dock and managing float</span>
        <span class="c1"># and unfloat behavior. We need to hook up to the dockLocationChanged</span>
        <span class="c1"># signal because a floating DockWidget can be redocked with a</span>
        <span class="c1"># double click of the window, which won&#39;t go through our button.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">float_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toggle_floating</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hide_dock</span><span class="p">)</span>

        <span class="c1"># We will be passing up our own signal when note and reply entities</span>
        <span class="c1"># are created.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">entity_created</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_created</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_stylesheet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_title_bar_buttons</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># This will handle showing or hiding the dock title bar</span>
        <span class="c1"># depending on what the parent is.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="c1">##########################################################################</span>
    <span class="c1"># properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The current Shotgun entity that is active in the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_entity</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_pinned</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the panel is pinned and not processing entity</span>
<span class="sd">        updates, and False if it is not pinned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinned</span>

    <span class="k">def</span> <span class="nf">_get_note_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The list of Note entity field names that are queried and provided</span>
<span class="sd">        when note_arrived is emitted.</span>

<span class="sd">        :returns:   list(str, ...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_note_fields</span>

    <span class="k">def</span> <span class="nf">_set_note_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_note_fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

    <span class="n">note_fields</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_note_fields</span><span class="p">,</span> <span class="n">_set_note_fields</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">note_threads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The currently loaded Note threads keyed by Note entity id and</span>
<span class="sd">        containing a list of Shotgun entity dictionaries.</span>

<span class="sd">        Example structure containing a single Note entity::</span>

<span class="sd">            6038: [</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;content&#39;: &#39;This is a test note.&#39;,</span>
<span class="sd">                    &#39;created_by&#39;: {</span>
<span class="sd">                        &#39;id&#39;: 39,</span>
<span class="sd">                        &#39;name&#39;: &#39;Jeff Beeland&#39;,</span>
<span class="sd">                        &#39;type&#39;: &#39;HumanUser&#39;</span>
<span class="sd">                    },</span>
<span class="sd">                    &#39;id&#39;: 6038,</span>
<span class="sd">                    &#39;sg_metadata&#39;: None,</span>
<span class="sd">                    &#39;type&#39;: &#39;Note&#39;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">note_threads</span>

    <span class="k">def</span> <span class="nf">_get_attachments_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If set to a compiled regular expression, attachment file names that match</span>
<span class="sd">        will be filtered OUT and NOT shown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachments_filter</span>

    <span class="k">def</span> <span class="nf">_set_attachments_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attachments_filter</span> <span class="o">=</span> <span class="n">regex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">attachments_filter</span> <span class="o">=</span> <span class="n">regex</span>

    <span class="n">attachments_filter</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">_get_attachments_filter</span><span class="p">,</span>
        <span class="n">_set_attachments_filter</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_notes_are_selectable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If True, note entity widgets in the activity stream will be selectable</span>
<span class="sd">        by the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">notes_are_selectable</span>

    <span class="k">def</span> <span class="nf">_set_notes_are_selectable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">notes_are_selectable</span> <span class="o">=</span> <span class="n">state</span>

    <span class="n">notes_are_selectable</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">_get_notes_are_selectable</span><span class="p">,</span>
        <span class="n">_set_notes_are_selectable</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_pre_submit_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The pre-submit callback function, if one is registered. If so, this</span>
<span class="sd">        Python callable will be run prior to Note or Reply submission, and</span>
<span class="sd">        will be given the calling :class:`NoteInputWidget` as its first and</span>
<span class="sd">        only argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">pre_submit_callback</span>

    <span class="k">def</span> <span class="nf">_set_pre_submit_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">pre_submit_callback</span> <span class="o">=</span> <span class="n">callback</span>

    <span class="n">pre_submit_callback</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">_get_pre_submit_callback</span><span class="p">,</span>
        <span class="n">_set_pre_submit_callback</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1">##########################################################################</span>
    <span class="c1"># public methods</span>

<div class="viewcode-block" id="VersionDetailsWidget.add_note_attachments"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.add_note_attachments">[docs]</a>    <span class="k">def</span> <span class="nf">add_note_attachments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">,</span> <span class="n">note_entity</span><span class="p">,</span> <span class="n">cleanup_after_upload</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a given list of files to the note widget as file attachments.</span>

<span class="sd">        :param file_paths:              A list of file paths to attach to the</span>
<span class="sd">                                        current note.</span>
<span class="sd">        :param cleanup_after_upload:    If True, after the files are uploaded</span>
<span class="sd">                                        to Shotgun they will be removed from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">note_entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Reply&quot;</span><span class="p">:</span>
            <span class="n">note_entity</span> <span class="o">=</span> <span class="n">note_entity</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_uids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span><span class="o">.</span><span class="n">execute_method</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__upload_file</span><span class="p">,</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
                    <span class="n">parent_entity_type</span><span class="o">=</span><span class="n">note_entity</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="n">parent_entity_id</span><span class="o">=</span><span class="n">note_entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="n">cleanup_after_upload</span><span class="o">=</span><span class="n">cleanup_after_upload</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">))</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.add_query_fields"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.add_query_fields">[docs]</a>    <span class="k">def</span> <span class="nf">add_query_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the given list of Shotgun field names to the list of fields</span>
<span class="sd">        that are queried by the version details widget&#39;s internal data</span>
<span class="sd">        model. Adding fields this way does not change the display of</span>
<span class="sd">        information about the entity in any way.</span>

<span class="sd">        :param fields:  A list of Shotgun field names to add.</span>
<span class="sd">        :type fields:   [field_name, ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">])</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.add_version_context_menu_action"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.add_version_context_menu_action">[docs]</a>    <span class="k">def</span> <span class="nf">add_version_context_menu_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_definition</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an action to the version tab&#39;s context menu.</span>

<span class="sd">        Action definitions passed in must take the following form::</span>

<span class="sd">            dict(</span>
<span class="sd">                callback=callable,</span>
<span class="sd">                text=str,</span>
<span class="sd">                required_selection=&quot;single&quot;</span>
<span class="sd">            )</span>

<span class="sd">        Where the callback is a callable object that expects to receive</span>
<span class="sd">        a list of Version entity dictionaries as returned by the Shotgun</span>
<span class="sd">        Python API. The text key contains the string labels of the action</span>
<span class="sd">        in the QMenu, and the required_selection is one of &quot;single&quot;, &quot;multi&quot;,</span>
<span class="sd">        or &quot;either&quot;. Any action requiring a &quot;single&quot; selection will be enabled</span>
<span class="sd">        only if there is a single item selected in the Version list view,</span>
<span class="sd">        those requiring &quot;multi&quot; selection require 2 or more selected items,</span>
<span class="sd">        and the &quot;either&quot; requirement results in the action being enabled if</span>
<span class="sd">        one or more items are selected.</span>

<span class="sd">        :param action_definition:   The action defition to add to the menu.</span>
<span class="sd">                                    This takes the form of a dictionary of</span>
<span class="sd">                                    a structure described in the method docs</span>
<span class="sd">                                    above.</span>
<span class="sd">        :type action_definition:    dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_context_menu_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action_definition</span><span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.clear"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clears all data from all widgets and views in the details panel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_more_info_toggled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pages</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">empty_page</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_info_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_entity</span> <span class="o">=</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.deselect_note"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.deselect_note">[docs]</a>    <span class="k">def</span> <span class="nf">deselect_note</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a note is currently selected, it will be deselected. This will NOT</span>
<span class="sd">        trigger a note_deselected signal to be emitted, as that is only emitted</span>
<span class="sd">        when the user triggers the deselection and not via procedural means.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">deselect_note</span><span class="p">()</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.download_note_attachments"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.download_note_attachments">[docs]</a>    <span class="k">def</span> <span class="nf">download_note_attachments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Triggers the attachments linked to the given Note entity to</span>
<span class="sd">        be downloaded. When the download is completed successfully, an</span>
<span class="sd">        attachment_downloaded signal is emitted.</span>

<span class="sd">        :param int note_id: The Note entity id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attachments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_note_attachments</span><span class="p">(</span><span class="n">note_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attachment</span> <span class="ow">in</span> <span class="n">attachments</span><span class="p">:</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span><span class="o">.</span><span class="n">request_attachment</span><span class="p">(</span><span class="n">attachment</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attachment_uids</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">note_id</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.get_note_attachments"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.get_note_attachments">[docs]</a>    <span class="k">def</span> <span class="nf">get_note_attachments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the Attachment entities associated with the given Note</span>
<span class="sd">        entity.</span>

<span class="sd">        :param int note_id: The Note entity id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">get_note_attachments</span><span class="p">(</span><span class="n">note_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.load_data"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.load_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the given Shotgun entity into the details panel,</span>
<span class="sd">        triggering the notes and versions streams to be updated</span>
<span class="sd">        relative to the given entity.</span>

<span class="sd">        :param entity:  The Shotgun entity to load. This is a dict in</span>
<span class="sd">                        the form returned by the Shotgun Python API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span> <span class="o">=</span> <span class="n">entity</span>

        <span class="c1"># If we&#39;re pinned, then we don&#39;t allow loading new entities.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pinned</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># If we got an &quot;empty&quot; entity from the mode, then we need</span>
        <span class="c1"># to clear everything out and go back to an empty state.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Switch over to the page that contains the primary display</span>
        <span class="c1"># widget set now that we have data to show.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pages</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">main_page</span><span class="p">)</span>

        <span class="c1"># If there aren&#39;t any fields set in the info widget then it</span>
        <span class="c1"># likely means we&#39;re loading from a &quot;cleared&quot; slate and need</span>
        <span class="c1"># to re-add our relevant fields.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">label_exempt_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_persistent_fields</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="n">shot_filters</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_info_model</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span>
            <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
            <span class="n">filters</span><span class="o">=</span><span class="n">shot_filters</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">note_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">note_threads</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_note_arrival</span><span class="p">(</span><span class="n">note_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entity_loaded</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.save_preferences"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.save_preferences">[docs]</a>    <span class="k">def</span> <span class="nf">save_preferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves user preferences to disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">FIELDS_PREFS_KEY</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">ACTIVE_FIELDS_PREFS_KEY</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">VERSION_LIST_FIELDS_PREFS_KEY</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">fields</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.set_note_metadata"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.set_note_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">set_note_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_id</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a Note entity&#39;s metadata in Shotgun.</span>

<span class="sd">        :param int note_id: The Note entity id.</span>
<span class="sd">        :param str metadata: The metadata to set in Shotgun.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_note_set_metadata_uids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span><span class="o">.</span><span class="n">execute_update</span><span class="p">(</span>
                <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
                <span class="n">note_id</span><span class="p">,</span>
                <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">NOTE_METADATA_FIELD</span><span class="p">:</span><span class="n">metadata</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.set_note_screenshot"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.set_note_screenshot">[docs]</a>    <span class="k">def</span> <span class="nf">set_note_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes the given file path to an image and sets the new note</span>
<span class="sd">        widget&#39;s thumbnail image.</span>

<span class="sd">        :param str image_path:  A file path to an image file on disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">note_widget</span><span class="o">.</span><span class="n">_set_screenshot_pixmap</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.set_pinned"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.set_pinned">[docs]</a>    <span class="k">def</span> <span class="nf">set_pinned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the &quot;pinned&quot; state of the details panel. When the panel is</span>
<span class="sd">        pinned it will not accept updates. It will, however, record the</span>
<span class="sd">        most recent entity passed to load_data that was not accepted. If</span>
<span class="sd">        the panel is unpinned at a later time, the most recent rejected</span>
<span class="sd">        entity update will be executed at that time.</span>

<span class="sd">        :param bool checked: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pinned</span> <span class="o">=</span> <span class="n">checked</span>

        <span class="k">if</span> <span class="n">checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pin_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/version_details/tack_hover.png&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pin_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/version_details/tack_up.png&quot;</span><span class="p">))</span>
            <span class="c1"># If we have a valid current_entity, be sure the incoming entity</span>
            <span class="c1"># has a different ID.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span><span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.show_new_note_dialog"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.show_new_note_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">show_new_note_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows a dialog that allows the user to input a new note.</span>

<span class="sd">        :param bool modal: Whether the dialog should be shown modally or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">show_new_note_dialog</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="n">modal</span><span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.show_title_bar_buttons"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.show_title_bar_buttons">[docs]</a>    <span class="k">def</span> <span class="nf">show_title_bar_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the visibility of the undock and close buttons in the</span>
<span class="sd">        widget&#39;s title bar.</span>

<span class="sd">        :param bool state: Whether to show or hide the buttons.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">float_button</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">close_button</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.set_version_thumbnail"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.set_version_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">set_version_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thumbnail_path</span><span class="p">,</span> <span class="n">version_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a Version entity&#39;s thumbnail image in Shotgun. If no Version</span>
<span class="sd">        id is provided, the current Version entity will be updated.</span>

<span class="sd">        :param str thumbnail_path: The path to the thumbnail file on disk.</span>
<span class="sd">        :param int version_id: The Version entity&#39;s id. If not provided</span>
<span class="sd">                               then the current Version entity loaded in</span>
<span class="sd">                               the widget will be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">version_id</span> <span class="o">=</span> <span class="n">version_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span><span class="o">.</span><span class="n">execute_method</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__upload_thumbnail</span><span class="p">,</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">entity_type</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                <span class="n">entity_id</span><span class="o">=</span><span class="n">version_id</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="n">thumbnail_path</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VersionDetailsWidget.use_styled_title_bar"><a class="viewcode-back" href="../../version_details.html#version_details.VersionDetailsWidget.use_styled_title_bar">[docs]</a>    <span class="k">def</span> <span class="nf">use_styled_title_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dock_widget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the use of the included, custom styled title bar is desired, the</span>
<span class="sd">        parent QDockWidget can be provided here and the styled title bar will</span>
<span class="sd">        be displayed.</span>

<span class="sd">        :param dock_widget: The parent QDockWidget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span> <span class="o">=</span> <span class="n">dock_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_title_bar_buttons</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">dock_widget</span><span class="o">.</span><span class="n">dockLocationChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dock_location_changed</span><span class="p">)</span></div>

    <span class="c1">##########################################################################</span>
    <span class="c1"># internal utilities</span>

    <span class="k">def</span> <span class="nf">_process_note_arrival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When a new Note entity arrives from Shotgun in the version details</span>
<span class="sd">        widget, Dynamite is notified and provided the Note entity&#39;s metadata.</span>

<span class="sd">        :param int note_id: The id of the Note entity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity_fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">Note</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NOTE_METADATA_FIELD</span><span class="p">],</span>
            <span class="n">Reply</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NOTE_METADATA_FIELD</span><span class="p">],</span> 
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_note_metadata_uids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_retriever</span><span class="o">.</span><span class="n">execute_find_one</span><span class="p">(</span>
                <span class="s2">&quot;Note&quot;</span><span class="p">,</span>
                <span class="p">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">note_id</span><span class="p">]],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">note_fields</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_task_completed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Signaled whenever the worker completes something. This method will</span>
<span class="sd">        dispatch the work to different methods depending on what async task</span>
<span class="sd">        has completed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__on_worker_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Signaled whenever the worker completes something. This method will</span>
<span class="sd">        dispatch the work to different methods depending on what async task</span>
<span class="sd">        has completed.</span>

<span class="sd">        :param int uid: Unique id for the request.</span>
<span class="sd">        :param str request_type: The request class.</span>
<span class="sd">        :param dict data: The returned data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_note_metadata_uids</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sg&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">note_arrived</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">entity</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_note_set_metadata_uids</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sg&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">note_metadata_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
                <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="n">entity</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">NOTE_METADATA_FIELD</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachment_uids</span><span class="p">:</span>
            <span class="n">note_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachment_uids</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachment_uids</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">note_attachment_arrived</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">note_id</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_uids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">rescan</span><span class="p">(</span><span class="n">force_activity_stream_update</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__on_worker_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronous callback - the worker thread errored.</span>
<span class="sd">        </span>
<span class="sd">        :param int uid: Unique id for request that failed.</span>
<span class="sd">        :param str msg: The error message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_note_metadata_uids</span><span class="p">:</span>
            <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_bundle</span><span class="p">()</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attachment_uids</span><span class="p">:</span>
            <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_bundle</span><span class="p">()</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_stylesheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads in the widget&#39;s master stylesheet from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qss_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span>
            <span class="s2">&quot;style.qss&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">qss_file</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span>
            <span class="n">qss_data</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_bundle</span><span class="p">()</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">_resolve_sg_stylesheet_tokens</span><span class="p">(</span>
                <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">qss_data</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_entity_created</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits the entity_created signal.</span>

<span class="sd">        :param dict entity: The Shotgun entity dict that was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity_created</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_field_menu_triggered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds or removes a field when it checked or unchecked</span>
<span class="sd">        via the EntityFieldMenu.</span>

<span class="sd">        :param action: The QMenuAction that was triggered. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action</span><span class="p">:</span>
            <span class="c1"># The MenuAction&#39;s data will have a &quot;field&quot; key that was</span>
            <span class="c1"># added by the EntityFieldMenu that contains the name of</span>
            <span class="c1"># the field that was checked or unchecked.</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">data</span><span class="p">()[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">remove_field</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">fields</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
                    <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">FIELDS_PREFS_KEY</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
                    <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">ACTIVE_FIELDS_PREFS_KEY</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_version_entity_data_refreshed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Takes the currently-requested entity and sets various widgets</span>
<span class="sd">        to display it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_info_model</span><span class="o">.</span><span class="n">item_from_entity</span><span class="p">(</span>
            <span class="s2">&quot;Version&quot;</span><span class="p">,</span>
            <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">sg_data</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get_sg_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">entity</span> <span class="o">=</span> <span class="n">sg_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_more_info_toggled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_info_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">sg_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entity&quot;</span><span class="p">):</span>
            <span class="n">version_filters</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;entity&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="n">sg_data</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_model</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span>
                <span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                <span class="n">filters</span><span class="o">=</span><span class="n">version_filters</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> 
                <span class="p">(</span>
                    <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AscendingOrder</span> <span class="k">if</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">_sort_versions_ascending</span> <span class="k">else</span> 
                    <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_entity</span> <span class="o">=</span> <span class="n">sg_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_entity_project_schema_cached</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_fields_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_version_list_fields_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_version_sort_by_menu</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ensure_entity_project_schema_cached</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures that the schema is cached before enabling the Fields buttons.</span>

<span class="sd">        This prevents errors when trying to display the field menu before the</span>
<span class="sd">        schema is properly cached.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># disconnect any previous connection so that the slot isn&#39;t called</span>
        <span class="c1"># multiple times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shotgun_globals</span><span class="o">.</span><span class="n">schema_loaded</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_schema_loaded</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># ---- disable the buttons until the schema is cached. set a tooltip</span>
        <span class="c1">#      just in case someone tries to click before the cache is loaded</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_fields_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_fields_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Caching SG fields. Please hold...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_fields_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_fields_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Caching SG fields. Please hold...&quot;</span><span class="p">)</span>

        <span class="c1"># use the current entity to retrieve the project id to ensure is cached</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">project_id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="c1"># run this callback once the cache is loaded</span>
        <span class="n">shotgun_globals</span><span class="o">.</span><span class="n">run_on_schema_loaded</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_schema_loaded</span><span class="p">,</span> <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_schema_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback that enables the field buttons once the schema is cached.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># disable these until the schema is cached</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_fields_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_fields_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Select fields to display&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_fields_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_fields_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Select fields to display&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_version_list_field_menu_triggered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds or removes a field when it checked or unchecked</span>
<span class="sd">        via the EntityFieldMenu.</span>

<span class="sd">        :param action:  The QMenuAction that was triggered. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action</span><span class="p">:</span>
            <span class="c1"># The MenuAction&#39;s data will have a &quot;field&quot; key that was</span>
            <span class="c1"># added by the EntityFieldMenu that contains the name of</span>
            <span class="c1"># the field that was checked or unchecked.</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">data</span><span class="p">()[</span><span class="s2">&quot;field&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

                <span class="c1"># When a field is added to the list, then we also need to</span>
                <span class="c1"># add it to the sort-by menu.</span>
                <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_sort_by_fields</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_sort_by_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_requested_entity</span><span class="p">)</span>

                    <span class="n">new_action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span>
                        <span class="n">shotgun_globals</span><span class="o">.</span><span class="n">get_field_display_name</span><span class="p">(</span>
                            <span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                            <span class="n">field_name</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="bp">self</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">new_action</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                    <span class="n">new_action</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_fields</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">new_action</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">new_action</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_sort_version_list</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">remove_field</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

                <span class="c1"># We also need to remove the field from the sort-by menu. We</span>
                <span class="c1"># will leave &quot;id&quot; in the list always, even if it isn&#39;t being</span>
                <span class="c1"># displayed by the delegate.</span>
                <span class="k">if</span> <span class="n">field_name</span> <span class="o">!=</span> <span class="s2">&quot;id&quot;</span> <span class="ow">and</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_sort_by_fields</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_sort_by_fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                    <span class="n">sort_actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span><span class="o">.</span><span class="n">actions</span><span class="p">()</span>
                    <span class="n">remove_action</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">sort_actions</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="o">==</span> <span class="n">field_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># If it&#39;s the current primary sort field, then we need to</span>
                    <span class="c1"># fall back on &quot;id&quot; to take its place.</span>
                    <span class="k">if</span> <span class="n">remove_action</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                        <span class="n">actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_fields</span><span class="o">.</span><span class="n">actions</span><span class="p">()</span>
                        <span class="n">id_action</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">actions</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">id_action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_version_list</span><span class="p">(</span><span class="n">id_action</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span><span class="o">.</span><span class="n">removeAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_fields</span><span class="o">.</span><span class="n">removeAction</span><span class="p">(</span><span class="n">remove_action</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">filter_by_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">setFilterWildcard</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_search</span><span class="o">.</span><span class="n">search_text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">repaint</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
                    <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">FIELDS_PREFS_KEY</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
                    <span class="n">VersionDetailsWidget</span><span class="o">.</span><span class="n">VERSION_LIST_FIELDS_PREFS_KEY</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">fields</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_settings_manager</span><span class="o">.</span><span class="n">SCOPE_ENGINE</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_more_info_toggled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggled more/less info functionality for the info widget in the</span>
<span class="sd">        Notes tab.</span>

<span class="sd">        :param bool checked: True or False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUpdatesEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">checked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_info_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Hide info&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_fields_button</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">set_field_visibility</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_info_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;More info&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_fields_button</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_persistent_fields</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">set_field_visibility</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUpdatesEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_selected_version_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of Version entities that are currently selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selection_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="n">selection_model</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">shotgun_model</span><span class="o">.</span><span class="n">get_sg_data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">image_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">widget_cache</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">thumbnail</span><span class="o">.</span><span class="n">image_file_path</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">image_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;__image_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_file</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">entities</span>

    <span class="k">def</span> <span class="nf">_set_version_list_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the Version list proxy model&#39;s filter pattern and forces</span>
<span class="sd">        a reselection of any items in the list.</span>

<span class="sd">        :param filter_text: The pattern to set as the proxy model&#39;s</span>
<span class="sd">                            filter wildcard.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Forcing a reselection handles forcing a rebuild of any</span>
        <span class="c1"># editor widgets and will ensure we draw/sort/filter properly.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">setFilterWildcard</span><span class="p">(</span><span class="n">filter_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">force_reselection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_setup_fields_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the EntityFieldMenu and attaches it as the &quot;More fields&quot;</span>
<span class="sd">        button&#39;s menu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">EntityFieldMenu</span><span class="p">(</span>
            <span class="s2">&quot;Version&quot;</span><span class="p">,</span>
            <span class="n">project_id</span><span class="o">=</span><span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">set_field_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_filter</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">set_checked_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checked_filter</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">set_disabled_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_disabled_filter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_field_menu</span> <span class="o">=</span> <span class="n">menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_field_menu</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_menu_triggered</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">more_fields_button</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_version_list_fields_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the EntityFieldMenu and attaches it as the &quot;More fields&quot;</span>
<span class="sd">        button&#39;s menu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">EntityFieldMenu</span><span class="p">(</span>
            <span class="s2">&quot;Version&quot;</span><span class="p">,</span>
            <span class="n">project_id</span><span class="o">=</span><span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">set_field_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_filter</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">set_checked_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version_list_checked_filter</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">set_disabled_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version_list_disabled_filter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_field_menu</span> <span class="o">=</span> <span class="n">menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_field_menu</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version_list_field_menu_triggered</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_fields_button</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_version_sort_by_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the sort-by menu in the Versions tab.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span> <span class="o">=</span> <span class="n">ShotgunMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;version_sort_menu&quot;</span><span class="p">)</span>

        <span class="n">ascending</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Ascending&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">descending</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Descending&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">ascending</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">descending</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">descending</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_directions</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QActionGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_fields</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QActionGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_directions</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_fields</span><span class="o">.</span><span class="n">setExclusive</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_directions</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">ascending</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_directions</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">descending</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span><span class="o">.</span><span class="n">add_group</span><span class="p">([</span><span class="n">ascending</span><span class="p">,</span> <span class="n">descending</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Direction&quot;</span><span class="p">)</span>

        <span class="n">field_actions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_sort_by_fields</span><span class="p">:</span>
            <span class="n">display_name</span> <span class="o">=</span> <span class="n">shotgun_globals</span><span class="o">.</span><span class="n">get_field_display_name</span><span class="p">(</span>
                <span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                <span class="n">field_name</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="n">display_name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="c1"># We store the database field name on the action, but</span>
            <span class="c1"># display the &quot;pretty&quot; name for users.</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">((</span><span class="n">field_name</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_fields</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="n">field_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span><span class="o">.</span><span class="n">add_group</span><span class="p">(</span><span class="n">field_actions</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;By Field&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_directions</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_toggle_sort_order</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu_fields</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sort_version_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">version_sort_button</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version_sort_menu</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_version_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows the version list context menu containing all available</span>
<span class="sd">        actions. Which actions are enabled is determined by how many</span>
<span class="sd">        items in the list are selected.</span>

<span class="sd">        :param point:   The QPoint location to show the context menu at.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selection_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selected_version_entities</span><span class="p">()</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">SelectionContextMenu</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">menu_action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_context_menu_actions</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action_definition</span><span class="o">=</span><span class="n">menu_action</span><span class="p">)</span>

        <span class="c1"># Show the menu at the mouse cursor. Whatever action is</span>
        <span class="c1"># chosen from the menu will have its callback executed.</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">entity_version_view</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">point</span><span class="p">))</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">execute_callback</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__upload_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads any generic file attachments to Shotgun, parenting</span>
<span class="sd">        them to the given entity.</span>

<span class="sd">        :param sg: A Shotgun API instance.</span>
<span class="sd">        :param dict data: A dictionary containing &quot;parent_entity_type&quot;,</span>
<span class="sd">                          &quot;parent_entity_id&quot;, &quot;file_path&quot;, and</span>
<span class="sd">                          &quot;cleanup_after_upload&quot; keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;parent_entity_type&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;parent_entity_id&quot;</span><span class="p">],</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cleanup_after_upload&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">rescan</span><span class="p">(</span><span class="n">force_activity_stream_update</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__upload_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads an image file as a thumbnail for the given entity. This</span>
<span class="sd">        is intended to be used with the execute_method call from a Shotgun</span>
<span class="sd">        data retriever object.</span>

<span class="sd">        The data dictionary will take the following form:</span>
<span class="sd">            dict(</span>
<span class="sd">                entity_type=str,</span>
<span class="sd">                entity_id=int,</span>
<span class="sd">                path=str,</span>
<span class="sd">            )</span>

<span class="sd">        :param sg: A Shotgun API instance.</span>
<span class="sd">        :param dict data: A dictionary of data passed through from the</span>
<span class="sd">                          Shotgun data retriever.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">upload_thumbnail</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;entity_id&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">note_stream_widget</span><span class="o">.</span><span class="n">rescan</span><span class="p">(</span><span class="n">force_activity_stream_update</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">thumbnail</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
        <span class="p">)</span>
        
    <span class="c1">##########################################################################</span>
    <span class="c1"># docking</span>

    <span class="k">def</span> <span class="nf">_dock_location_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the dock being redocked in some location. This will</span>
<span class="sd">        trigger removing the default title bar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="o">.</span><span class="n">setTitleBarWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_hide_dock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hides the parent dock widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_toggle_floating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles the parent dock widget&#39;s floating status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="o">.</span><span class="n">isFloating</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="o">.</span><span class="n">setFloating</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dock_location_changed</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="o">.</span><span class="n">setTitleBarWidget</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dock_widget</span><span class="o">.</span><span class="n">setFloating</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1">##########################################################################</span>
    <span class="c1"># version list actions</span>

    <span class="k">def</span> <span class="nf">_toggle_sort_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggles ascending/descending sort ordering in the version list view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_versions_ascending</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_versions_ascending</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> 
            <span class="p">(</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AscendingOrder</span> <span class="k">if</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_sort_versions_ascending</span> <span class="k">else</span> 
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># We need to force a reselection after sorting. This will</span>
        <span class="c1"># remove edit widgets and allow a full repaint of the view,</span>
        <span class="c1"># and then reselect to go back to editing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">force_reselection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sort_version_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the version list by the field chosen in the sort-by</span>
<span class="sd">        menu. This also triggers a reselection in the view in</span>
<span class="sd">        order to ensure proper sorting and drawing of items in the</span>
<span class="sd">        list.</span>

<span class="sd">        :param action:  The QAction chosen by the user from the menu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action</span><span class="p">:</span>
            <span class="c1"># The action group containing these actions is set to</span>
            <span class="c1"># exclusive activation, so we&#39;re always dealing with a</span>
            <span class="c1"># checked action when this slot is called. We can just</span>
            <span class="c1"># set the primary sort field, sort, and move on.</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">data</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;id&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">primary_sort_field</span> <span class="o">=</span> <span class="n">field</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version_proxy_model</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> 
            <span class="p">(</span>
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AscendingOrder</span> <span class="k">if</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">_sort_versions_ascending</span> <span class="k">else</span> 
                <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DescendingOrder</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># We need to force a reselection after sorting. This will</span>
        <span class="c1"># remove edit widgets and allow a full repaint of the view,</span>
        <span class="c1"># and then reselect to go back to editing.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">force_reselection</span><span class="p">()</span>

    <span class="c1">##########################################################################</span>
    <span class="c1"># fields menu filters</span>

    <span class="k">def</span> <span class="nf">_checked_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checked filter method for the EntityFieldMenu. Determines whether the</span>
<span class="sd">        given field should be checked in the field menu.</span>

<span class="sd">        :param field:   The field name being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_version_list_checked_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checked filter method for the EntityFieldMenu. Determines whether the</span>
<span class="sd">        given field should be checked in the field menu.</span>

<span class="sd">        :param field:   The field name being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_delegate</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_disabled_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disabled filter method for the EntityFieldMenu. Determines whether the</span>
<span class="sd">        given field should be active or disabled in the field menu.</span>

<span class="sd">        :param field:   The field name being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_persistent_fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_version_list_disabled_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disabled filter method for the EntityFieldMenu. Determines whether the</span>
<span class="sd">        given field should be active or disabled in the field menu.</span>

<span class="sd">        :param field:   The field name being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_list_persistent_fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_field_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Field filter method for the EntityFieldMenu. Determines whether the</span>
<span class="sd">        given field should be included in the field menu.</span>

<span class="sd">        :param str field: The field name being processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># see if we can display this field</span>
        <span class="n">supported</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">current_version_card</span><span class="o">.</span><span class="n">field_manager</span><span class="o">.</span><span class="n">supported_fields</span><span class="p">(</span>
            <span class="s2">&quot;Version&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">field</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c1"># get the current version entity&#39;s project id</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_entity</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">project_id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="c1"># Detect bubble fields. If the field_name is &quot;sg_sequence.Sequence.code&quot;</span>
        <span class="c1"># then we know we want to get the data type of the &quot;code&quot; field on the</span>
        <span class="c1"># &quot;Sequence&quot; entity type.</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">field</span><span class="p">:</span>
            <span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>

        <span class="c1"># make sure the field is visible</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">shotgun_globals</span><span class="o">.</span><span class="n">field_is_visible</span><span class="p">(</span>
                <span class="n">entity_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span></div>

</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Autodesk.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'v2.5.15',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2114792-1', 'auto');
  ga('send', 'pageview');
</script>



</body>
</html>